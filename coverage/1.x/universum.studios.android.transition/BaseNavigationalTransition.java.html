<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>BaseNavigationalTransition.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=0;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">debugAndroidTest</a> &gt; <a href="index.source.html" class="el_package">universum.studios.android.transition</a> &gt; <span class="el_source">BaseNavigationalTransition.java</span></div><h1>BaseNavigationalTransition.java</h1><pre class="source lang-java linenums">/*
 * =================================================================================================
 *                             Copyright (C) 2017 Universum Studios
 * =================================================================================================
 *         Licensed under the Apache License, Version 2.0 or later (further &quot;License&quot; only).
 * -------------------------------------------------------------------------------------------------
 * You may use this file only in compliance with the License. More details and copy of this License
 * you may obtain at
 *
 * 		http://www.apache.org/licenses/LICENSE-2.0
 *
 * You can redistribute, modify or publish any part of the code written within this file but as it
 * is described in the License, the software distributed under the License is distributed on an
 * &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES or CONDITIONS OF ANY KIND.
 *
 * See the License for the specific language governing permissions and limitations under the License.
 * =================================================================================================
 */
package universum.studios.android.transition;

import android.annotation.SuppressLint;
import android.annotation.TargetApi;
import android.app.Activity;
import android.app.ActivityOptions;
import android.app.Fragment;
import android.content.Context;
import android.content.Intent;
import android.os.Build;
import android.os.Bundle;
import android.support.annotation.IntRange;
import android.support.annotation.NonNull;
import android.support.annotation.Nullable;
import android.transition.Transition;
import android.transition.TransitionInflater;
import android.transition.TransitionManager;
import android.util.Pair;
import android.view.View;
import android.view.ViewGroup;
import android.view.Window;

import java.util.ArrayList;
import java.util.Arrays;
import java.util.List;

/**
 * BaseNavigationalTransition represents a simple wrapper around window {@link Transition Transitions}
 * framework to simplify and also to made transitioning between two {@link Activity Activities}
 * independent from the current Android version, that is, to hide such transitions implementation
 * from the context where it is used.
 * &lt;p&gt;
 * A specific navigational transition implementation may be associated with its corresponding activity
 * class that can be supplied to {@link #BaseNavigationalTransition(Class)} constructor. This class
 * is used to create an instance of Intent that will be by default started whenever {@link #start(Activity)}
 * is invoked. Both {@link #onStart(Activity)} and {@link #onFinish(Activity)} methods cen be overridden
 * by a specific transition implementations to match theirs specific needs.
 *
 * &lt;h3&gt;Sample&lt;/h3&gt;
 * &lt;pre&gt;
 * public abstract class DetailTransition extends BaseNavigationalTransition {
 *
 *     DetailTransition() {
 *         super(DetailActivity.class);
 *     }
 *
 *     &amp;#64;NonNull
 *     public static DetailTransition get() {
 *          return UiConfig.MATERIAL_SUPPORT ? new MaterialTransition() : new DefaultTransition();
 *     }
 *
 *     &amp;#64;Override
 *     public Intent createIntent(&amp;#64;NonNull Activity caller) {
 *         final Intent intent = super.createIntent(caller);
 *         // ... put here any extras that need to be delivered to the called activity
 *         return intent;
 *     }
 *
 *     static final class DefaultTransition extends DetailTransition {
 *
 *          &amp;#64;Override
 *          protected void onStart(&amp;#64;NonNull Activity caller) {
 *              super.onStart(caller);
 *              // ... change activities with custom window animation
 *              WindowTransition.overrideStart(caller);
 *          }
 *
 *          &amp;#64;Override
 *          protected void onFinish(&amp;#64;NonNull Activity caller) {
 *              super.onFinish(caller);
 *              // ... change activities without animation
 *              caller.overridePendingTransition(0, 0);
 *          }
 *     }
 *
 *     // ... other implementations specific for a different platform versions
 *
 *     static final class MaterialTransition extends DetailTransition {
 *
 *          &amp;#64;Override
 *          protected void onStart(&amp;#64;NonNull Activity caller) {
 *              // ... made some modifications to the caller's UI (if necessary) before the transitions
 *              // ... are triggered.
 *              super.onStart(caller);
 *          }
 *
 *          &amp;#64;Override
 *          protected void onFinish(&amp;#64;NonNull Activity caller) {
 *              super.onFinish(caller);
 *              // ... no need to override in most cases
 *          }
 *     }
 * }
 * &lt;/pre&gt;
 *
 * @author Martin Albedinsky
 */
public abstract class BaseNavigationalTransition&lt;T extends BaseNavigationalTransition&gt; {

	/**
	 * Constants ===================================================================================
	 */

	/**
	 * Log TAG.
	 */
	//private static final String TAG = &quot;BaseNavigationalTransition&quot;;

	/**
	 * Boolean flag indicating whether the current Android device can run Material Design like navigational
	 * transition (i. e. with shared elements, ...) or not.
	 */
<span class="nc bnc" id="L131" title="All 2 branches missed.">	public static final boolean MATERIAL_SUPPORT = Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.LOLLIPOP;</span>

	/**
	 * Flag determining that no request code has been specified for a specific navigational transition.
	 */
	public static final int RC_NONE = -1;

	/**
	 * Flag determining whether an &lt;b&gt;enter&lt;/b&gt; transition has been specified via
	 * {@link #enterTransition(Transition)} or ot.
	 */
	private static final int TRANSITION_ENTER = 0x00000001;

	/**
	 * Flag determining whether a &lt;b&gt;reenter&lt;/b&gt; transition has been specified via
	 * {@link #reenterTransition(Transition)} or ot.
	 */
	private static final int TRANSITION_REENTER = 0x00000001 &lt;&lt; 1;

	/**
	 * Flag determining whether a &lt;b&gt;return&lt;/b&gt; transition has been specified via
	 * {@link #returnTransition(Transition)} or ot.
	 */
	private static final int TRANSITION_RETURN = 0x00000001 &lt;&lt; 2;

	/**
	 * Flag determining whether an &lt;b&gt;exit&lt;/b&gt; transition has been specified via
	 * {@link #exitTransition(Transition)} or ot.
	 */
	private static final int TRANSITION_EXIT = 0x00000001 &lt;&lt; 3;

	/**
	 * Flag determining whether a shared element's &lt;b&gt;enter&lt;/b&gt; transition has been specified via
	 * {@link #sharedElementEnterTransition(Transition)} or ot.
	 */
	private static final int TRANSITION_SHARED_ELEMENT_ENTER = 0x00000001 &lt;&lt; 4;

	/**
	 * Flag determining whether a shared element's &lt;b&gt;reenter&lt;/b&gt; transition has been specified via
	 * {@link #sharedElementReenterTransition(Transition)} or ot.
	 */
	private static final int TRANSITION_SHARED_ELEMENT_REENTER = 0x00000001 &lt;&lt; 5;

	/**
	 * Flag determining whether a shared element's &lt;b&gt;return&lt;/b&gt; transition has been specified via
	 * {@link #sharedElementReturnTransition(Transition)} or ot.
	 */
	private static final int TRANSITION_SHARED_ELEMENT_RETURN = 0x00000001 &lt;&lt; 6;

	/**
	 * Flag determining whether a shared element's &lt;b&gt;exit&lt;/b&gt; transition has been specified via
	 * {@link #sharedElementExitTransition(Transition)} or ot.
	 */
	private static final int TRANSITION_SHARED_ELEMENT_EXIT = 0x00000001 &lt;&lt; 7;

	/**
	 * Interface ===================================================================================
	 */

	/**
	 * Static members ==============================================================================
	 */

	/**
	 * Members =====================================================================================
	 */

	/**
	 * Class of activity that should be started as new Intent whenever this navigational transition
	 * is started via {@link #start(Activity)}.
	 */
	protected final Class&lt;? extends Activity&gt; mClassOfTransitionActivity;

	/**
	 * Bundle containing extras for the activity transition activity.
	 */
	private Bundle mIntentExtras;

	/**
	 * If set (other than {@link #RC_NONE}) starting of intent specific for this navigational transition
	 * will be performed via {@link Activity#startActivityForResult(Intent, int)}, {@link Activity#startActivityForResult(Intent, int, Bundle)}
	 * or {@link Fragment#startActivityForResult(Intent, int)} depends on the type of caller and
	 * current configuration of this transition.
	 */
<span class="nc" id="L215">	int mRequestCode = RC_NONE;</span>

	/**
	 * Transition that should be attached to caller's activity window if {@link #TRANSITION_ENTER}
	 * flag is contained within {@link #mSpecifiedTransitions} flags.
	 *
	 * @see Window#setEnterTransition(Transition)
	 */
	private Transition mEnterTransition;

	/**
	 * Transition that should be attached to caller's activity window if {@link #TRANSITION_REENTER}
	 * flag is contained within {@link #mSpecifiedTransitions} flags.
	 *
	 * @see Window#setReenterTransition(Transition)
	 */
	private Transition mReenterTransition;

	/**
	 * Transition that should be attached to caller's activity window if {@link #TRANSITION_RETURN}
	 * flag is contained within {@link #mSpecifiedTransitions} flags.
	 *
	 * @see Window#setReturnTransition(Transition)
	 */
	private Transition mReturnTransition;

	/**
	 * Transition that should be attached to caller's activity window if {@link #TRANSITION_EXIT}
	 * flag is contained within {@link #mSpecifiedTransitions} flags.
	 *
	 * @see Window#setExitTransition(Transition)
	 */
	private Transition mExitTransition;

	/**
	 * Transition for shared element that should be attached to caller's activity window if
	 * {@link #TRANSITION_SHARED_ELEMENT_ENTER} flag is contained within {@link #mSpecifiedTransitions} flags.
	 *
	 * @see Window#setSharedElementEnterTransition(Transition)
	 */
	private Transition mSharedElementEnterTransition;

	/**
	 * Transition for shared element that should be attached to caller's activity window if
	 * {@link #TRANSITION_SHARED_ELEMENT_REENTER} flag is contained within {@link #mSpecifiedTransitions} flags.
	 *
	 * @see Window#setSharedElementReenterTransition(Transition)
	 */
	private Transition mSharedElementReenterTransition;

	/**
	 * Transition for shared element that should be attached to caller's activity window if
	 * {@link #TRANSITION_SHARED_ELEMENT_RETURN} flag is contained within {@link #mSpecifiedTransitions} flags.
	 *
	 * @see Window#setSharedElementReturnTransition(Transition)
	 */
	private Transition mSharedElementReturnTransition;

	/**
	 * Transition for shared element that should be attached to caller's activity window if
	 * {@link #TRANSITION_SHARED_ELEMENT_EXIT} flag is contained within {@link #mSpecifiedTransitions} flags.
	 *
	 * @see Window#setSharedElementExitTransition(Transition)
	 */
	private Transition mSharedElementExitTransition;

	/**
	 * Transition flags determining which transitions has been specified for this navigational transition.
	 */
	private int mSpecifiedTransitions;

	/**
	 * Boolean flag indicating whether an &lt;b&gt;enter&lt;/b&gt; transition can overlap or not.
	 */
	private Boolean mAllowEnterTransitionOverlap;

	/**
	 * Boolean flag indicating whether an &lt;b&gt;return&lt;/b&gt; transition can overlap or not.
	 */
	private Boolean mAllowReturnTransitionOverlap;

	/**
	 * List containing all shared elements specified for this navigational transition. If not empty,
	 * these elements should be transferred to the called activity through Bundle created from
	 * ActivityOptions that can be created via {@link #makeSceneTransitionAnimation(Activity)}.
	 */
	private List&lt;Pair&lt;View, String&gt;&gt; mSharedElements;

	/**
	 * Inflater that can be used to inflate a new transition or transition manager.
	 */
	private TransitionInflater mTransitionInflater;

	/**
	 * Constructors ================================================================================
	 */

	/**
	 * Creates a new instance of NavigationalTransition without transition activity class.
	 */
<span class="nc" id="L315">	public BaseNavigationalTransition() {</span>
<span class="nc" id="L316">		this.mClassOfTransitionActivity = null;</span>
<span class="nc" id="L317">	}</span>

	/**
	 * Creates a new instance of NavigationalTransition with the specified class of transition activity.
	 *
	 * @param classOfTransitionActivity The activity class that should be used to create a new Intent
	 *                                  that to be started whenever {@link #start(Activity)} is called
	 *                                  upon this navigational transition.
	 */
<span class="nc" id="L326">	public BaseNavigationalTransition(@NonNull Class&lt;? extends Activity&gt; classOfTransitionActivity) {</span>
<span class="nc" id="L327">		this.mClassOfTransitionActivity = classOfTransitionActivity;</span>
<span class="nc" id="L328">	}</span>

	/**
	 * Methods =====================================================================================
	 */

	/**
	 * Specifies a bundle with extras for the transition activity. The given bundle will be attached
	 * to this transition's {@link Intent} via {@link Intent#putExtras(Bundle)} when it is created
	 * via {@link #createIntent(Activity)}.
	 *
	 * @param extras The desired bundle with extras. May be {@code null} to clear the current one.
	 * @return This transition to allow methods chaining.
	 * @see #intentExtras()
	 */
	@SuppressWarnings(&quot;unchecked&quot;)
	public T intentExtras(@Nullable Bundle extras) {
<span class="nc" id="L345">		this.mIntentExtras = extras;</span>
<span class="nc" id="L346">		return (T) this;</span>
	}

	/**
	 * Returns the bundle with extras for the transition activity.
	 * &lt;p&gt;
	 * This will be either bundle specified via {@link #intentExtras(Bundle)} or created by default
	 * when this method is called for the first time.
	 *
	 * @return The extras bundle for the transition activity.
	 * @see #intentExtras(Bundle)
	 */
	@NonNull
	public Bundle intentExtras() {
<span class="nc bnc" id="L360" title="All 2 branches missed.">		return mIntentExtras == null ? (mIntentExtras = new Bundle()) : mIntentExtras;</span>
	}

	/**
	 * Specifies a request code that should be used to start activity specific for this navigational
	 * transition &lt;b&gt;for result&lt;/b&gt;.
	 * &lt;p&gt;
	 * Default value: &lt;b&gt;{@link #RC_NONE}&lt;/b&gt;
	 *
	 * @param requestCode The desired request code. Can be {@link #RC_NONE} to not start activity
	 *                    for result.
	 * @return This transition to allow methods chaining.
	 * @see Activity#startActivityForResult(Intent, int)
	 * @see Activity#startActivityForResult(Intent, int, Bundle)
	 * @see Fragment#startActivityForResult(Intent, int)
	 */
	@SuppressWarnings(&quot;unchecked&quot;)
	public T requestCode(@IntRange(from = RC_NONE) int requestCode) {
<span class="nc" id="L378">		this.mRequestCode = requestCode;</span>
<span class="nc" id="L379">		return (T) this;</span>
	}

	/**
	 * Returns the request code specified via {@link #requestCode(int)}.
	 *
	 * @return Specified request code or {@link #RC_NONE} by default.
	 */
	@IntRange(from = RC_NONE)
	public int requestCode() {
<span class="nc" id="L389">		return mRequestCode;</span>
	}

	/**
	 * Specifies a transition to be attached to a window of the caller activity whenever
	 * {@link #start(Activity)} is invoked.
	 *
	 * @return This transition to allow methods chaining.
	 * @see Window#setEnterTransition(Transition)
	 * @see #inflateTransition(Context, int)
	 */
	@SuppressWarnings(&quot;unchecked&quot;)
	public T enterTransition(@Nullable Transition transition) {
<span class="nc" id="L402">		this.mSpecifiedTransitions |= TRANSITION_ENTER;</span>
<span class="nc" id="L403">		this.mEnterTransition = transition;</span>
<span class="nc" id="L404">		return (T) this;</span>
	}

	/**
	 * @return Transition specified via {@link #enterTransition(Transition)} or {@code null} by
	 * default.
	 */
	@Nullable
	public Transition enterTransition() {
<span class="nc" id="L413">		return mEnterTransition;</span>
	}

	/**
	 * Specifies a transition to be attached to a window of the caller activity whenever
	 * {@link #start(Activity)} is invoked.
	 *
	 * @return This transition to allow methods chaining.
	 * @see Window#setReenterTransition(Transition)
	 * @see #inflateTransition(Context, int)
	 */
	@SuppressWarnings(&quot;unchecked&quot;)
	public T reenterTransition(@Nullable Transition transition) {
<span class="nc" id="L426">		this.mSpecifiedTransitions |= TRANSITION_REENTER;</span>
<span class="nc" id="L427">		this.mReenterTransition = transition;</span>
<span class="nc" id="L428">		return (T) this;</span>
	}

	/**
	 * @return Transition specified via {@link #reenterTransition(Transition)} or {@code null} by
	 * default.
	 */
	@Nullable
	public Transition reenterTransition() {
<span class="nc" id="L437">		return mReenterTransition;</span>
	}

	/**
	 * Specifies a transition to be attached to a window of the caller activity whenever
	 * {@link #start(Activity)} is invoked.
	 *
	 * @return This transition to allow methods chaining.
	 * @see Window#setReturnTransition(Transition)
	 * @see #inflateTransition(Context, int)
	 */
	@SuppressWarnings(&quot;unchecked&quot;)
	public T returnTransition(@Nullable Transition transition) {
<span class="nc" id="L450">		this.mSpecifiedTransitions |= TRANSITION_RETURN;</span>
<span class="nc" id="L451">		this.mReturnTransition = transition;</span>
<span class="nc" id="L452">		return (T) this;</span>
	}

	/**
	 * @return Transition specified via {@link #returnTransition(Transition)} or {@code null} by
	 * default.
	 */
	@Nullable
	public Transition returnTransition() {
<span class="nc" id="L461">		return mReturnTransition;</span>
	}

	/**
	 * Specifies a transition to be attached to a window of the caller activity whenever
	 * {@link #start(Activity)} is invoked.
	 *
	 * @return This transition to allow methods chaining.
	 * @see Window#setExitTransition(Transition)
	 * @see #inflateTransition(Context, int)
	 */
	@SuppressWarnings(&quot;unchecked&quot;)
	public T exitTransition(@Nullable Transition transition) {
<span class="nc" id="L474">		this.mSpecifiedTransitions |= TRANSITION_EXIT;</span>
<span class="nc" id="L475">		this.mExitTransition = transition;</span>
<span class="nc" id="L476">		return (T) this;</span>
	}

	/**
	 * @return Transition specified via {@link #exitTransition(Transition)} or {@code null} by
	 * default.
	 */
	@Nullable
	public Transition exitTransition() {
<span class="nc" id="L485">		return mExitTransition;</span>
	}

	/**
	 * Specifies a boolean flag to be set to a window of the caller activity whenever
	 * {@link #start(Activity)} is invoked.
	 *
	 * @return This transition to allow methods chaining.
	 * @see Window#setAllowEnterTransitionOverlap(boolean)
	 */
	@SuppressWarnings(&quot;unchecked&quot;)
	public T allowEnterTransitionOverlap(boolean allow) {
<span class="nc" id="L497">		this.mAllowEnterTransitionOverlap = allow;</span>
<span class="nc" id="L498">		return (T) this;</span>
	}

	/**
	 * @return {@code True} if overlapping of enter transition is enabled, {@code false} otherwise.
	 */
	public boolean allowEnterTransitionOverlap() {
<span class="nc bnc" id="L505" title="All 4 branches missed.">		return mAllowEnterTransitionOverlap != null &amp;&amp; mAllowEnterTransitionOverlap;</span>
	}

	/**
	 * Specifies a boolean flag to be set to a window of the caller activity whenever
	 * {@link #start(Activity)} is invoked.
	 *
	 * @return This transition to allow methods chaining.
	 * @see Window#setAllowReturnTransitionOverlap(boolean)
	 */
	@SuppressWarnings(&quot;unchecked&quot;)
	public T allowReturnTransitionOverlap(boolean allow) {
<span class="nc" id="L517">		this.mAllowReturnTransitionOverlap = allow;</span>
<span class="nc" id="L518">		return (T) this;</span>
	}

	/**
	 * @return {@code True} if overlapping of return transition is enabled, {@code false} otherwise.
	 */
	public boolean allowReturnTransitionOverlap() {
<span class="nc bnc" id="L525" title="All 4 branches missed.">		return mAllowReturnTransitionOverlap != null &amp;&amp; mAllowReturnTransitionOverlap;</span>
	}

	/**
	 * Specifies a transition for shared element to be attached to a window of the caller activity
	 * whenever {@link #start(Activity)} is invoked.
	 *
	 * @return This transition to allow methods chaining.
	 * @see Window#setSharedElementEnterTransition(Transition)
	 * @see #inflateTransition(Context, int)
	 */
	@SuppressWarnings(&quot;unchecked&quot;)
	public T sharedElementEnterTransition(@Nullable Transition transition) {
<span class="nc" id="L538">		this.mSpecifiedTransitions |= TRANSITION_SHARED_ELEMENT_ENTER;</span>
<span class="nc" id="L539">		this.mSharedElementEnterTransition = transition;</span>
<span class="nc" id="L540">		return (T) this;</span>
	}

	/**
	 * @return Transition for shared element specified via {@link #sharedElementEnterTransition(Transition)}
	 * or {@code null} by default.
	 */
	@Nullable
	public Transition sharedElementEnterTransition() {
<span class="nc" id="L549">		return mSharedElementEnterTransition;</span>
	}

	/**
	 * Specifies a transition for shared element to be attached to a window of the caller activity
	 * whenever {@link #start(Activity)} is invoked.
	 *
	 * @return This transition to allow methods chaining.
	 * @see Window#setSharedElementReenterTransition(Transition)
	 * @see #inflateTransition(Context, int)
	 */
	@SuppressWarnings(&quot;unchecked&quot;)
	public T sharedElementReenterTransition(@Nullable Transition transition) {
<span class="nc" id="L562">		this.mSpecifiedTransitions |= TRANSITION_SHARED_ELEMENT_REENTER;</span>
<span class="nc" id="L563">		this.mSharedElementReenterTransition = transition;</span>
<span class="nc" id="L564">		return (T) this;</span>
	}

	/**
	 * @return Transition for shared element specified via {@link #sharedElementReenterTransition(Transition)}
	 * or {@code null} by default.
	 */
	@Nullable
	public Transition sharedElementReenterTransition() {
<span class="nc" id="L573">		return mSharedElementReenterTransition;</span>
	}

	/**
	 * Specifies a transition for shared element to be attached to a window of the caller activity
	 * whenever {@link #start(Activity)} is invoked.
	 *
	 * @return This transition to allow methods chaining.
	 * @see Window#setSharedElementReturnTransition(Transition)
	 * @see #inflateTransition(Context, int)
	 */
	@SuppressWarnings(&quot;unchecked&quot;)
	public T sharedElementReturnTransition(@Nullable Transition transition) {
<span class="nc" id="L586">		this.mSpecifiedTransitions |= TRANSITION_SHARED_ELEMENT_RETURN;</span>
<span class="nc" id="L587">		this.mSharedElementReturnTransition = transition;</span>
<span class="nc" id="L588">		return (T) this;</span>
	}

	/**
	 * @return Transition for shared element specified via {@link #sharedElementReturnTransition(Transition)}
	 * or {@code null} by default.
	 */
	@Nullable
	public Transition sharedElementReturnTransition() {
<span class="nc" id="L597">		return mSharedElementReturnTransition;</span>
	}

	/**
	 * Specifies a transition for shared element to be attached to a window of the caller activity
	 * whenever {@link #start(Activity)} is invoked.
	 *
	 * @return This transition to allow methods chaining.
	 * @see Window#setSharedElementExitTransition(Transition)
	 * @see #inflateTransition(Context, int)
	 */
	@SuppressWarnings(&quot;unchecked&quot;)
	public T sharedElementExitTransition(@Nullable Transition transition) {
<span class="nc" id="L610">		this.mSpecifiedTransitions |= TRANSITION_SHARED_ELEMENT_EXIT;</span>
<span class="nc" id="L611">		this.mSharedElementExitTransition = transition;</span>
<span class="nc" id="L612">		return (T) this;</span>
	}

	/**
	 * @return Transition for shared element specified via {@link #sharedElementExitTransition(Transition)}
	 * or {@code null} by default.
	 */
	@Nullable
	public Transition sharedElementExitTransition() {
<span class="nc" id="L621">		return mSharedElementExitTransition;</span>
	}

	/**
	 * Inflates a new instance of Transition from the specified &lt;var&gt;resource&lt;/var&gt;.
	 * &lt;p&gt;
	 * &lt;b&gt;Note&lt;/b&gt;, that for pre {@link Build.VERSION_CODES#LOLLIPOP LOLLIPOP} Android
	 * versions this method does nothing and returns {@code null}.
	 *
	 * @param context  Context used to inflate the desired transition.
	 * @param resource Resource id of the desired transition to inflate.
	 * @return Inflated transition.
	 * @see #inflateTransitionManager(Context, int, ViewGroup)
	 */
	@Nullable
	@SuppressLint(&quot;NewApi&quot;)
	public Transition inflateTransition(@NonNull Context context, int resource) {
<span class="nc bnc" id="L638" title="All 2 branches missed.">		if (MATERIAL_SUPPORT) {</span>
<span class="nc bnc" id="L639" title="All 2 branches missed.">			if (mTransitionInflater == null) {</span>
<span class="nc" id="L640">				this.mTransitionInflater = TransitionInflater.from(context);</span>
			}
<span class="nc" id="L642">			return mTransitionInflater.inflateTransition(resource);</span>
		}
<span class="nc" id="L644">		return null;</span>
	}

	/**
	 * Inflates a new instance of TransitionManager from the specified &lt;var&gt;resource&lt;/var&gt;.
	 * &lt;p&gt;
	 * &lt;b&gt;Note&lt;/b&gt;, that for pre {@link Build.VERSION_CODES#LOLLIPOP LOLLIPOP} Android
	 * versions this method does nothing and returns {@code null}.
	 *
	 * @param context   Context used to inflate the desired transition.
	 * @param resource  Resource id of the desired transition manager to inflater.
	 * @param sceneRoot Root view for the scene with which will the manager operate.
	 * @return Inflated transition manager.
	 * @see #inflateTransition(Context, int)
	 */
	@Nullable
	@SuppressLint(&quot;NewApi&quot;)
	public TransitionManager inflateTransitionManager(@NonNull Context context, int resource, @NonNull ViewGroup sceneRoot) {
<span class="nc bnc" id="L662" title="All 2 branches missed.">		if (MATERIAL_SUPPORT) {</span>
<span class="nc bnc" id="L663" title="All 2 branches missed.">			if (mTransitionInflater == null) {</span>
<span class="nc" id="L664">				this.mTransitionInflater = TransitionInflater.from(context);</span>
			}
<span class="nc" id="L666">			return mTransitionInflater.inflateTransitionManager(resource, sceneRoot);</span>
		}
<span class="nc" id="L668">		return null;</span>
	}

	/**
	 * Bulk method for adding shared element pairs into this navigational transition.
	 *
	 * @param elements The desired shared elements pairs.
	 * @return This transition to allow methods chaining.
	 * @see #sharedElement(View, String)
	 */
	@SafeVarargs
	@SuppressWarnings(&quot;unchecked&quot;)
	public final T sharedElements(@NonNull Pair&lt;View, String&gt;... elements) {
<span class="nc bnc" id="L681" title="All 2 branches missed.">		if (mSharedElements == null) {</span>
<span class="nc" id="L682">			this.mSharedElements = new ArrayList&lt;&gt;(1);</span>
		}
<span class="nc" id="L684">		mSharedElements.addAll(Arrays.asList(elements));</span>
<span class="nc" id="L685">		return (T) this;</span>
	}

	/**
	 * Adds shared element that should be transferred to the transitioning (called) activity via
	 * {@link ActivityOptions} as Bundle.
	 * &lt;p&gt;
	 * All shared elements and their names added into this navigational transition will be bundled
	 * from ActivityOptions created via {@link #makeSceneTransitionAnimation(Activity)} and transferred
	 * to the called activity whenever {@link #start(Activity)} is called.
	 * &lt;p&gt;
	 * &lt;b&gt;Note&lt;/b&gt;, that each shared element must have a unique name.
	 *
	 * @param element     The view to be shared via transition.
	 * @param elementName The name of the shared element.
	 * @return This transition to allow methods chaining.
	 * @see #sharedElements(Pair[])
	 * @see #makeSceneTransitionAnimation(Activity)
	 */
	@SuppressWarnings(&quot;unchecked&quot;)
	public T sharedElement(@NonNull View element, @NonNull String elementName) {
<span class="nc bnc" id="L706" title="All 2 branches missed.">		if (mSharedElements == null) {</span>
<span class="nc" id="L707">			this.mSharedElements = new ArrayList&lt;&gt;(1);</span>
		}
<span class="nc" id="L709">		mSharedElements.add(new Pair&lt;&gt;(element, elementName));</span>
<span class="nc" id="L710">		return (T) this;</span>
	}

	/**
	 * Returns a list of all shared elements specified for this navigational transition.
	 *
	 * @return List of shared elements or {@code null} if there are no shared elements specified.
	 * @see #sharedElements(Pair[])
	 * @see #sharedElement(View, String)
	 * @see #singleSharedElement()
	 */
	@Nullable
	public List&lt;Pair&lt;View, String&gt;&gt; sharedElements() {
<span class="nc" id="L723">		return mSharedElements;</span>
	}

	/**
	 * Returns the single shared element at the {@code 0} position among the current shared elements.
	 * &lt;p&gt;
	 * This method may be used to obtain a single shared element when there is specified only one for
	 * this navigational transition.
	 *
	 * @return Single shared element or {@code null} if there are no shared elements specified.
	 * @see #sharedElements()
	 * @see #sharedElement(View, String)
	 */
	@Nullable
	public Pair&lt;View, String&gt; singleSharedElement() {
<span class="nc bnc" id="L738" title="All 4 branches missed.">		return mSharedElements != null &amp;&amp; !mSharedElements.isEmpty() ? mSharedElements.get(0) : null;</span>
	}

	/**
	 * Starts this navigational transition using the given &lt;var&gt;caller&lt;/var&gt; activity with all
	 * transitions and shared elements specified for this navigational transition.
	 *
	 * @param caller The activity that will be used to create and start an Intent created via
	 *               {@link #createIntent(Activity)}.
	 * @see #configureTransitionsOverlapping(Activity)
	 * @see #configureTransitions(Activity)
	 */
	public void start(@NonNull Activity caller) {
<span class="nc" id="L751">		configureTransitionsOverlapping(caller);</span>
<span class="nc" id="L752">		configureTransitions(caller);</span>
<span class="nc" id="L753">		onStart(caller);</span>
<span class="nc" id="L754">	}</span>

	/**
	 * Invoked whenever {@link #start(Activity)} is called.
	 * &lt;p&gt;
	 * Default implementation starts an Intent created via {@link #createIntent(Activity)} using
	 * the given caller activity via {@link Activity#startActivity(Intent)} for the pre LOLLIPOP
	 * Android versions and for the post LOLLIPOP via {@link Activity#startActivity(Intent, Bundle)}
	 * where will be passed Bundle created from {@link ActivityOptions} that has been requested via
	 * {@link #makeSceneTransitionAnimation(Activity)}.
	 * &lt;p&gt;
	 * If there was specified some {@link #requestCode()} the intent will be started via
	 * {@link Activity#startActivityForResult(Intent, int)} for the pre LOLLIPOP Android versions
	 * and for the post LOLLIPOP via {@link Activity#startActivityForResult(Intent, int, Bundle)}.
	 * &lt;p&gt;
	 * &lt;b&gt;Note&lt;/b&gt;, that the specified caller activity has already attached transitions to its
	 * window, that has been specified for this navigational transition via one of {@code set...Transition(...)}
	 * methods.
	 *
	 * @param caller The caller activity that requested start of this navigational transition.
	 * @see #attachTransitions(Window)
	 * @see #attachSharedElementTransitions(Window)
	 * @see #onFinish(Activity)
	 */
	@SuppressLint(&quot;NewApi&quot;)
	@SuppressWarnings(&quot;ConstantConditions&quot;)
	protected void onStart(@NonNull Activity caller) {
<span class="nc" id="L781">		final Intent intent = createIntent(caller);</span>
<span class="nc bnc" id="L782" title="All 2 branches missed.">		if (MATERIAL_SUPPORT) {</span>
<span class="nc" id="L783">			final Bundle options = makeSceneTransitionAnimation(caller).toBundle();</span>
<span class="nc bnc" id="L784" title="All 2 branches missed.">			if (mRequestCode == RC_NONE) caller.startActivity(intent, options);</span>
<span class="nc" id="L785">			else caller.startActivityForResult(intent, mRequestCode, options);</span>
<span class="nc" id="L786">		} else {</span>
<span class="nc bnc" id="L787" title="All 2 branches missed.">			if (mRequestCode == RC_NONE) caller.startActivity(intent);</span>
<span class="nc" id="L788">			else caller.startActivityForResult(intent, mRequestCode);</span>
		}
<span class="nc" id="L790">	}</span>

	/**
	 * Like {@link #finishCaller(Activity)} but this will postpone the finishing by the requested
	 * &lt;var&gt;delay&lt;/var&gt;.
	 *
	 * @param caller The caller activity to finish.
	 * @param delay  The desired delay after which to finish the caller activity.
	 */
	protected void finishCallerDelayed(@NonNull final Activity caller, @IntRange(from = 0) long delay) {
<span class="nc" id="L800">		final View decorView = caller.getWindow().getDecorView();</span>
<span class="nc bnc" id="L801" title="All 2 branches missed.">		if (decorView != null) decorView.postDelayed(new Runnable() {</span>

			/**
			 */
			@Override
			public void run() {
<span class="nc bnc" id="L807" title="All 2 branches missed.">				if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.JELLY_BEAN_MR1) {</span>
<span class="nc bnc" id="L808" title="All 4 branches missed.">					if (!caller.isDestroyed() &amp;&amp; !caller.isFinishing()) {</span>
<span class="nc" id="L809">						onFinishCaller(caller);</span>
					}
<span class="nc bnc" id="L811" title="All 2 branches missed.">				} else if (!caller.isFinishing()) {</span>
<span class="nc" id="L812">					onFinishCaller(caller);</span>
				}
<span class="nc" id="L814">			}</span>
		}, delay);
<span class="nc" id="L816">	}</span>

	/**
	 * Finishes the specified &lt;var&gt;caller&lt;/var&gt; activity either via {@link Activity#finishAfterTransition()}
	 * or via {@link Activity#finish()} depending on the current API capabilities.
	 *
	 * @param caller The caller activity to finish.
	 */
	protected void finishCaller(@NonNull Activity caller) {
<span class="nc" id="L825">		onFinishCaller(caller);</span>
<span class="nc" id="L826">	}</span>

	/**
	 * Invoked whenever {@link #finishCaller(Activity)} or {@link #finishCallerDelayed(Activity, long)}
	 * is called.
	 * &lt;p&gt;
	 * Default implementation finishes the caller activity either via {@link Activity#finishAfterTransition()}
	 * or via {@link Activity#finish()} depending on the current API capabilities.
	 *
	 * @param caller The caller activity to finish.
	 */
	@SuppressLint(&quot;NewApi&quot;)
	protected void onFinishCaller(@NonNull Activity caller) {
<span class="nc bnc" id="L839" title="All 2 branches missed.">		if (MATERIAL_SUPPORT) caller.finishAfterTransition();</span>
<span class="nc" id="L840">		else caller.finish();</span>
<span class="nc" id="L841">	}</span>

	/**
	 * Specifies a boolean flags for a window of the specified &lt;var&gt;activity&lt;/var&gt; determining whether
	 * an enter or return transition can overlap or not based on the requested values for this
	 * navigational transition.
	 * &lt;p&gt;
	 * &lt;b&gt;Note&lt;/b&gt;, that for pre {@link Build.VERSION_CODES#LOLLIPOP LOLLIPOP} Android
	 * versions this method does nothing.
	 *
	 * @param activity The activity for which window to specify whether an enter or return transition
	 *                 can overlap or not.
	 * @see Window#setAllowEnterTransitionOverlap(boolean)
	 * @see Window#setAllowReturnTransitionOverlap(boolean)
	 */
	@SuppressLint(&quot;NewApi&quot;)
	public void configureTransitionsOverlapping(@NonNull Activity activity) {
<span class="nc bnc" id="L858" title="All 2 branches missed.">		if (MATERIAL_SUPPORT) {</span>
<span class="nc" id="L859">			final Window window = activity.getWindow();</span>
<span class="nc bnc" id="L860" title="All 2 branches missed.">			if (mAllowEnterTransitionOverlap != null)</span>
<span class="nc" id="L861">				window.setAllowEnterTransitionOverlap(mAllowEnterTransitionOverlap);</span>
<span class="nc bnc" id="L862" title="All 2 branches missed.">			if (mAllowReturnTransitionOverlap != null)</span>
<span class="nc" id="L863">				window.setAllowReturnTransitionOverlap(mAllowReturnTransitionOverlap);</span>
		}
<span class="nc" id="L865">	}</span>

	/**
	 * Attaches all transitions, including those for shared elements, specified for this navigational
	 * transition to a window of the specified &lt;var&gt;activity&lt;/var&gt; via one of
	 * {@code Window#set...Transition(...)} methods.
	 * &lt;p&gt;
	 * &lt;b&gt;Note&lt;/b&gt;, that for pre {@link Build.VERSION_CODES#LOLLIPOP LOLLIPOP} Android
	 * versions this method does nothing.
	 *
	 * @param activity The activity to which window should be transitions attached.
	 * @see Window#setEnterTransition(Transition)
	 * @see Window#setReturnTransition(Transition)
	 * @see Window#setReenterTransition(Transition)
	 * @see Window#setExitTransition(Transition)
	 * @see Window#setSharedElementEnterTransition(Transition)
	 * @see Window#setSharedElementReturnTransition(Transition)
	 * @see Window#setSharedElementReenterTransition(Transition)
	 * @see Window#setSharedElementExitTransition(Transition)
	 */
	public void configureTransitions(@NonNull Activity activity) {
<span class="nc bnc" id="L886" title="All 2 branches missed.">		if (MATERIAL_SUPPORT) {</span>
<span class="nc" id="L887">			final Window window = activity.getWindow();</span>
<span class="nc" id="L888">			this.attachTransitions(window);</span>
<span class="nc" id="L889">			this.attachSharedElementTransitions(window);</span>
		}
<span class="nc" id="L891">	}</span>

	/**
	 * Attaches all transitions specified for this navigational transition to the given &lt;var&gt;window&lt;/var&gt;.
	 * &lt;p&gt;
	 * This will attach only transitions of which particular flags are contained within {@link #mSpecifiedTransitions}
	 * flags.
	 *
	 * @param window The window to which should be transitions attached.
	 */
	@TargetApi(Build.VERSION_CODES.LOLLIPOP)
	private void attachTransitions(Window window) {
<span class="nc bnc" id="L903" title="All 2 branches missed.">		if ((mSpecifiedTransitions &amp; TRANSITION_ENTER) != 0)</span>
<span class="nc" id="L904">			window.setEnterTransition(mEnterTransition);</span>
<span class="nc bnc" id="L905" title="All 2 branches missed.">		if ((mSpecifiedTransitions &amp; TRANSITION_REENTER) != 0)</span>
<span class="nc" id="L906">			window.setReenterTransition(mReenterTransition);</span>
<span class="nc bnc" id="L907" title="All 2 branches missed.">		if ((mSpecifiedTransitions &amp; TRANSITION_RETURN) != 0)</span>
<span class="nc" id="L908">			window.setReturnTransition(mReturnTransition);</span>
<span class="nc bnc" id="L909" title="All 2 branches missed.">		if ((mSpecifiedTransitions &amp; TRANSITION_EXIT) != 0)</span>
<span class="nc" id="L910">			window.setExitTransition(mExitTransition);</span>
<span class="nc" id="L911">	}</span>

	/**
	 * Attaches all transitions for shared elements specified for this navigational transition to
	 * the given &lt;var&gt;window&lt;/var&gt;.
	 * &lt;p&gt;
	 * This will attach only transitions of which particular flags are contained within {@link #mSpecifiedTransitions}
	 * flags.
	 *
	 * @param window The window to which should be transitions attached.
	 */
	@TargetApi(Build.VERSION_CODES.LOLLIPOP)
	private void attachSharedElementTransitions(Window window) {
<span class="nc bnc" id="L924" title="All 2 branches missed.">		if ((mSpecifiedTransitions &amp; TRANSITION_SHARED_ELEMENT_ENTER) != 0)</span>
<span class="nc" id="L925">			window.setSharedElementEnterTransition(mSharedElementEnterTransition);</span>
<span class="nc bnc" id="L926" title="All 2 branches missed.">		if ((mSpecifiedTransitions &amp; TRANSITION_SHARED_ELEMENT_REENTER) != 0)</span>
<span class="nc" id="L927">			window.setSharedElementReenterTransition(mSharedElementReenterTransition);</span>
<span class="nc bnc" id="L928" title="All 2 branches missed.">		if ((mSpecifiedTransitions &amp; TRANSITION_SHARED_ELEMENT_RETURN) != 0)</span>
<span class="nc" id="L929">			window.setSharedElementReturnTransition(mSharedElementReturnTransition);</span>
<span class="nc bnc" id="L930" title="All 2 branches missed.">		if ((mSpecifiedTransitions &amp; TRANSITION_SHARED_ELEMENT_EXIT) != 0)</span>
<span class="nc" id="L931">			window.setSharedElementExitTransition(mSharedElementExitTransition);</span>

<span class="nc" id="L933">	}</span>

	/**
	 * Creates a new instance of ActivityOptions for the specified &lt;var&gt;caller&lt;/var&gt; activity.
	 * &lt;p&gt;
	 * &lt;b&gt;Note&lt;/b&gt;, that for pre {@link Build.VERSION_CODES#LOLLIPOP LOLLIPOP} Android
	 * versions this method does nothing and returns {@code null}.
	 *
	 * @param caller The activity for which to create the ActivityOptions.
	 * @return Activity options with or without attached shared elements that has been added into
	 * this navigational transition (if any).
	 */
	@Nullable
	@SuppressLint(&quot;NewApi&quot;)
	@SuppressWarnings(&quot;unchecked&quot;)
	public ActivityOptions makeSceneTransitionAnimation(@NonNull Activity caller) {
<span class="nc bnc" id="L949" title="All 2 branches missed.">		if (MATERIAL_SUPPORT) {</span>
<span class="nc bnc" id="L950" title="All 4 branches missed.">			if (mSharedElements != null &amp;&amp; !mSharedElements.isEmpty()) {</span>
<span class="nc" id="L951">				final Pair&lt;View, String&gt;[] pairs = new Pair[mSharedElements.size()];</span>
<span class="nc" id="L952">				mSharedElements.toArray(pairs);</span>
<span class="nc" id="L953">				return ActivityOptions.makeSceneTransitionAnimation(caller, pairs);</span>
			}
<span class="nc" id="L955">			return ActivityOptions.makeSceneTransitionAnimation(caller);</span>
		}
<span class="nc" id="L957">		return null;</span>
	}

	/**
	 * Creates an intent that can be used to start activity for which is this transition created.
	 *
	 * @param caller Activity to be used as context when creating the requested intent.
	 * @return New Intent or {@code null} it this navigational transition has no class of transition
	 * activity specified.
	 */
	@NonNull
	public Intent createIntent(@NonNull Activity caller) {
<span class="nc bnc" id="L969" title="All 2 branches missed.">		if (mClassOfTransitionActivity == null) {</span>
<span class="nc" id="L970">			throw new UnsupportedOperationException(</span>
<span class="nc" id="L971">					&quot;Navigational transition(&quot; + getClass().getSimpleName() + &quot;) does not have any class of intended activity specified.&quot;</span>
			);
		}
<span class="nc" id="L974">		final Intent intent = new Intent(caller, mClassOfTransitionActivity);</span>
<span class="nc bnc" id="L975" title="All 2 branches missed.">		if (mIntentExtras != null) {</span>
<span class="nc" id="L976">			intent.putExtras(mIntentExtras);</span>
		}
<span class="nc" id="L978">		return intent;</span>
	}

	/**
	 * Finishes the given &lt;var&gt;caller&lt;/var&gt; activity in order to run its exit transitions.
	 *
	 * @param caller The activity that should be finished and of which exit transitions should be started.
	 * @see #start(Activity)
	 */
	public void finish(@NonNull Activity caller) {
<span class="nc" id="L988">		onFinish(caller);</span>
<span class="nc" id="L989">	}</span>

	/**
	 * Invoked whenever {@link #finish(Activity)} is called.
	 * &lt;p&gt;
	 * Default implementation finishes the given caller activity for the pre LOLLIPOP Android versions
	 * via {@link Activity#finish()} and for the post LOLLIPOP via {@link Activity#finishAfterTransition()}.
	 * &lt;p&gt;
	 * Derived classes can override this method in order to run custom window transitions for the
	 * pre LOLLIPOP Android versions via {@link Activity#overridePendingTransition(int, int)}.
	 *
	 * @param caller The activity that requested its finish via this navigational transition.
	 * @see #onStart(Activity)
	 */
	@SuppressLint(&quot;NewApi&quot;)
	protected void onFinish(@NonNull Activity caller) {
<span class="nc bnc" id="L1005" title="All 2 branches missed.">		if (MATERIAL_SUPPORT) caller.finishAfterTransition();</span>
<span class="nc" id="L1006">		else caller.finish();</span>
<span class="nc" id="L1007">	}</span>

	/**
	 * Inner classes ===============================================================================
	 */
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span>Generated by the Android Gradle plugin 2.3.0</div></body></html>